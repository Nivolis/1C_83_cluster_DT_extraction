# 1C_83_cluster_DT_extraction
Скрипт выгрузки всех баз в .dt для серверной версии 1С 83

Краткое функциональное описание:
 
-Проверяет условия для своего выполнения, пытается исправить, если условия не выполняются 
-Делает выгрузку всех баз серверной версии 1С в .dt, 
-Проверяет успешность выполнения бекапов, если найдены ошибки или выполнен бекап не всех баз на сервере 1С - шлет на почту письмо с кратким описанием ошибки
-Создает лог для каждой базы с результатом выполнения бекапа и глобальный лог с подробным отчетом о выполнении, который находится в том-же месте, что и скрипт.

Для успешного выполнения скрипта необходимо:

Powersheel версии 4
Ragent.exe, запущенный как служба
RAS.exe, запущенный как служба
Доступность источника и хранилища бекапов
Запуск скрипта от имени администратора(для регистрации и запуска служб)
Powersheel ExecutionPolicy Unrestricted

Порядок выполнения скрипта: 
 
-Задаем кодировку
-Указываем переменные
-Проверяем версию Powersheel, если она ниже 4 - останавливаем скрипт
-Проверяем запущенную службу Ragent, если она не запущена - пробуем запустить, если не получается - останавливаем скрипт
-Проверяем службу RAS - если она найдена, но не запущена пробуем запустить, если она не найдена - пробуем зарегистрировать, если не получается запустить или зарегистрировать - останавливаем скрипт
-Проверяем доступность хранилища бекапов, если недоступно - пытаемся создать папку по указанному в переменных адресу, если не получается - останавливаем скрипт
-Очищаем архивы старше 3 месяцев 
-Последовательно для каждой базы кластера блокируем регламентные задания, блокируем сеансы, пробуем выполнить бекап, ждем, пока все файлы временных логов не будут заполнены или пройдет 2 часа и включаем регламенентные задания
-Проверяем выполненные бекапы на успешность, если найдены ошибки или часть бекапов не выполнена - отправляем письмо

